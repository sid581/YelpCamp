<% layout('layouts/boilerplate') %>
 
<div id="map" style="width: 100%; height: 300px;"></div> 
<div class="container"> 
    <h1 class="text-center mb-4">Search And View Our Campgrounds</h1>
        <div class="container mt-3">
            <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-6">
                    <form class="row g-2 align-items-center" method="GET" action="/campground">
                        <div class="col-8">
                            <label for="search" class="visually-hidden">Search</label>
                            <input type="search" id="search" name="q" class="form-control" placeholder="Search campgrounds by title or location" value="<%= typeof q !== 'undefined' ? q : '' %>">
                        </div>
                        <div class="col-4 d-flex gap-2">
                            <button type="submit" class="btn btn-primary">Search</button>
                            <a href="/campground" class="btn btn-outline-secondary">Clear</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
<!-- <div><a href="/campground/new">New Campground</a></div> -->

<% for(let campground of campgrounds) {%>
<div class="card mb-3">
    <div class="row">
        <div class="col-md-4">
                <div style="height:200px; overflow:hidden;">
                    <% if (campground.images && campground.images.length) { %>
                        <img crossorigin="anonymous" src="<%= campground.images[0].url %>" alt="" style="width:100%; height:100%; object-fit:cover; display:block;">
                    <% } else { %>
                        <img crossorigin="anonymous" src="https://picsum.photos/400/300?random=1" alt="No image" style="width:100%; height:100%; object-fit:cover; display:block;">
                    <% } %>
                </div>
            </div>
        <div class="col-md-8  bg-light">
            <div class="card-body ">
                <h5 class="card-title"><%= campground.title %></h5>
                <p class="card-texttext-primary text-opacity-25"><%= campground.description %></p>
                <p class="card-text"> <small><%= campground.location %></small></p>
                <a href="/campground/<%= campground._id %>" class="btn btn-primary">view <%= campground.title %></a>
            </div>
        </div>
    </div>
</div>
<%  }%>
</div>
<%- "<script>" %>
const maptilerApiKey = "<%- process.env.MAPTILER_API_KEY %>";
const campgrounds = {
  type: "FeatureCollection",
  features: <%- JSON.stringify(
    campgrounds.map(campground => ({
      type: "Feature",
      geometry: campground.geometry,
      properties: { popUpMarkup: campground?.properties?.popUpMarkup }
    }))
  ) %>
};
<%- "</script>" %>

<script src="/javascripts/clusterMap.js"></script>